# onos-e2-sm
[O-RAN] defines the **E2 Service Models** in the form of "ASN.1" specifications. 

Each Service Model defines 5 top level objects:
1. **RAN Function Description** (from the E2Node, describes the supported actions and triggers)
1. **Event Trigger Defintion** (contained in a `RICSubscriptionRequest`, defines the conditions on which E2Node should send a `RICIndication`)
1. **Action Definition** (contained in a `RICSubscriptionRequest`, defines the actions on an E2Node)
1. **Indication Header** (contained in a `RICIndication`, describes general parameters of the source E2 Node)
1. **Indication Message** (contained in a `RICIndication`, describes specific parameters requested)

## Implementation in SD-RAN
The `onos-e2-sm` project provides, for each of these Service Models:
* A Protobuf translation of these ASN.1 specifications e.g. [e2sm_kpm_ies.proto](servicemodels/e2sm_kpm/v1beta1/e2sm_kpm_ies.proto)
* Go code mapping between Protobuf and ASN.1 PER encoding

The implementation can be accessed as either:
* a Go module e.g. `go get github.com/onosproject/onos-e2-sm/servicemodels/e2sm_kpm@v0.7.0`
  (preferred for **xApps** who only need to access the Proto defintions) or
* as a Go **plugin** e.g. `e2sm_kpm.so.1.0.0` (allowing a loose coupling with `onos-e2t` and `ran-simulator`)

> Third party vendors will be able to build their own Service Models and load them in to `onos-e2t` using the plugin method,
> and will be able to access the translated Protobuf in corresponding xApps

### Key Performance Metrics (E2SM_KPM)
This is the first E2 Service Model to be handled by SD-RAN - it is for extracting statistics from the E2Node

### Native Interface (E2SM_NI)
While the Proto defintions have been created for this Service Model, the Go mapping code has not been implemented in SD-RAN yet

## Development
Service models are created from the ASN1 models stored at:
https://github.com/onosproject/openairinterface5g/tree/develop-onf/openair2/RIC_AGENT/MESSAGES/ASN1/R01

From these:

* Protobuf is generated with `asn1c -B` (requires the specially modified version of `asn1c` tool - [asn1c](https://github.com/onosproject/asn1c))
* Go code is generated from this Protobuf as an interface/reusable layer e.g. [e2sm_kpm_ie.pb.go](servicemodels/e2sm_kpm/v1beta1/e2sm-kpm-ies/e2sm_kpm_ies.pb.go)
* C code is generated with `asn1c -fcompound-names -fincludes-quoted -fno-include-deps -findirect-choice -gen-PER -no-gen-OER -D.` e.g. [E2SM-KPM-IndicationHeader.h](servicemodels/e2sm_kpm/kpmctypes/E2SM-KPM-IndicationHeader.h)
* Then glue code is generated by hand (at first) using `CGO` (wrapping the C code in Go) e.g. [E2SM-KPM-IndicationHeader.go](servicemodels/e2sm_kpm/kpmctypes/E2SM-KPM-IndicationHeader.go)

The E2AP (E2 Application Protocol) is not a Service Model, and so is kept completely inside the `onos-e2t`.

## Note
Current implementation of E2SM KPM model in `CGO` gives an error related to the `GO` pointers referencing bunch of `C` files. 
You can verify it running `go test -v ./..` in `servicemodels/e2sm_kpm/kpmctypes/`.
To avoid this disable checking with `GODEBUG=cgocheck=0` or just run `GODEBUG=cgocheck=0 go test ./...`.

[O-RAN]: https://www.o-ran.org/
